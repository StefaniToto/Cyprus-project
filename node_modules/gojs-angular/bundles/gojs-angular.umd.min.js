!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("gojs")):"function"==typeof define&&define.amd?define("gojs-angular",["exports","@angular/core","gojs"],t):t((e=e||self)["gojs-angular"]={},e.ng.core,e.go)}(this,(function(e,t,a){"use strict";var i=function(){function e(e,a,i){this._differs=e,this._kvdiffers=a,this.zone=i,this.linkDataArray=null,this.modelData=null,this.modelChangedListener=null,this.skipsDiagramUpdate=!1,this.modelChange=new t.EventEmitter,this.diagram=null,this._ndaDiffer=this._kvdiffers.find([]).create(),this._ldaDiffer=this._kvdiffers.find([]).create()}return e.prototype.ngOnInit=function(){this.modelData&&(this._mdDiffer=this._kvdiffers.find(this.modelData).create())},e.prototype.ngAfterViewInit=function(){var e=this;this.diagram=this.initDiagram(),this.diagram.addEventListener=function(t,i,r,n){var o=a.Diagram.prototype.addEventListener;"mousemove"===i?e.zone.runOutsideAngular((function(){return o.call(e,t,i,r,n)})):e.zone.run((function(){o.call(e,t,i,r,n)}))};var t=this.diagramDiv.nativeElement;null!==t&&(this.diagram.div=t,this.diagram.delayInitialization((function(){e.diagram.model.commit((function(t){t.mergeNodeDataArray(t.cloneDeep(e.nodeDataArray)),e.linkDataArray&&t instanceof a.GraphLinksModel&&t.mergeLinkDataArray(t.cloneDeep(e.linkDataArray)),e.modelData&&t.assignAllDataProperties(t.modelData,e.modelData)}),null)})),this.modelChangedListener=function(t){t.isTransactionFinished&&e.zone.run((function(){var a=t.model.toIncrementalData(t);e.modelChange.emit(a)}))},this.diagram.addModelChangedListener(this.modelChangedListener))},e.prototype.ngDoCheck=function(){if(this.diagram&&this.diagram.model){var e=this._ndaDiffer.diff(this.nodeDataArray),t=this._ldaDiffer.diff(this.linkDataArray);if(!this.skipsDiagramUpdate){var a=this;null!==this.modelChangedListener&&this.diagram.model.removeChangedListener(this.modelChangedListener),this.diagram.model.startTransaction("update data"),i(e,"n"),i(t,"l"),this.diagram.model.assignAllDataProperties(this.diagram.model.modelData,this.modelData),this.diagram.model.commitTransaction("update data"),null!==this.modelChangedListener&&this.diagram.model.addChangedListener(this.modelChangedListener)}}function i(e,t){a.diagram&&a.diagram.model&&e&&(e.forEachAddedItem((function(e){switch(t){case"n":a.diagram.model.addNodeData(e.currentValue);break;case"l":a.diagram.model.addLinkData(e.currentValue)}})),e.forEachRemovedItem((function(e){switch(t){case"n":var i=a.diagram.findNodesByExample(e.previousValue).first();a.diagram.remove(i);break;case"l":var r=a.diagram.findLinksByExample(e.previousValue).first();a.diagram.remove(r)}})),e.forEachChangedItem((function(e){if(!function e(t,a){for(var i in t){if(t.hasOwnProperty(i)!==a.hasOwnProperty(i))return!1;switch(typeof t[i]){case"object":if(!e(t[i],a[i]))return!1;break;default:if(t[i]!==a[i])return!1}}for(var i in a)if(void 0===t[i])return!1;return!0}(e.currentValue,e.previousValue))switch(t){case"n":var i=a.diagram.findNodesByExample(e.previousValue).first();a.diagram.model.assignAllDataProperties(i.data,e.currentValue);break;case"l":var r=a.diagram.findLinksByExample(e.previousValue).first();a.diagram.model.assignAllDataProperties(r.data,e.currentValue)}})))}},e}();i.decorators=[{type:t.Component,args:[{selector:"gojs-diagram",template:"<div #ngDiagram [className]=divClassName></div>"}]}],i.ctorParameters=function(){return[{type:t.IterableDiffers},{type:t.KeyValueDiffers},{type:t.NgZone}]},i.propDecorators={initDiagram:[{type:t.Input}],nodeDataArray:[{type:t.Input}],linkDataArray:[{type:t.Input}],modelData:[{type:t.Input}],divClassName:[{type:t.Input}],modelChangedListener:[{type:t.Input}],skipsDiagramUpdate:[{type:t.Input}],modelChange:[{type:t.Output}],diagramDiv:[{type:t.ViewChild,args:["ngDiagram",{static:!0}]}]};var r=function(){function e(e,a,i){this._differs=e,this._kvdiffers=a,this.zone=i,this.linkDataArray=null,this.modelData=null,this.modelChangedListener=null,this.modelChange=new t.EventEmitter,this.palette=null,this._ndaDiffer=this._differs.find([]).create(null),this._ldaDiffer=this._differs.find([]).create(null)}return e.prototype.ngOnInit=function(){this.modelData&&(this._mdDiffer=this._kvdiffers.find(this.modelData).create())},e.prototype.ngAfterViewInit=function(){var e=this;if(this.paletteDiv){this.palette=this.initPalette(),this.palette.addEventListener=function(t,i,r,n){var o=a.Diagram.prototype.addEventListener;"mousemove"===i?e.zone.runOutsideAngular((function(){return o.call(e,t,i,r,n)})):e.zone.run((function(){o.call(e,t,i,r,n)}))};var t=this.paletteDiv.nativeElement;this.palette.div=t,this.palette.delayInitialization((function(){e.palette.model.commit((function(t){t.mergeNodeDataArray(t.cloneDeep(e.nodeDataArray)),e.linkDataArray&&t instanceof a.GraphLinksModel&&t.mergeLinkDataArray(t.cloneDeep(e.linkDataArray)),e.modelData&&t.assignAllDataProperties(t.modelData,e.modelData)}),null)})),this.modelChangedListener=function(t){t.isTransactionFinished&&e.zone.run((function(){var a=t.model.toIncrementalData(t);e.modelChange.emit(a)}))},this.palette.addModelChangedListener(this.modelChangedListener)}},e.prototype.ngDoCheck=function(){var e=this._ndaDiffer.diff(this.nodeDataArray),t=this._ldaDiffer.diff(this.linkDataArray),a=null;this._mdDiffer&&(a=this._mdDiffer.diff(this.modelData)),(e||t||a)&&this.updateFromAppData()},e.prototype.updateFromAppData=function(){if(this.palette){var e=this.palette.model;e.startTransaction("update data"),e.mergeNodeDataArray(e.cloneDeep(this.nodeDataArray)),this.linkDataArray&&e instanceof a.GraphLinksModel&&e.mergeLinkDataArray(e.cloneDeep(this.linkDataArray)),this.modelData&&e.assignAllDataProperties(e.modelData,this.modelData),e.commitTransaction("update data")}},e}();r.decorators=[{type:t.Component,args:[{selector:"gojs-palette",template:"<div #ngPalette [className]=divClassName></div>"}]}],r.ctorParameters=function(){return[{type:t.IterableDiffers},{type:t.KeyValueDiffers},{type:t.NgZone}]},r.propDecorators={initPalette:[{type:t.Input}],nodeDataArray:[{type:t.Input}],linkDataArray:[{type:t.Input}],modelData:[{type:t.Input}],divClassName:[{type:t.Input}],modelChangedListener:[{type:t.Input}],modelChange:[{type:t.Output}],paletteDiv:[{type:t.ViewChild,args:["ngPalette",{static:!0}]}]};var n=function(){function e(e){this.zone=e,this.observedDiagram=null,this.overview=null}return e.prototype.ngAfterViewInit=function(){var e=this;this.overviewDiv&&(this.initOverview?this.overview=this.initOverview():(this.overview=new a.Overview,this.overview.contentAlignment=a.Spot.Center),this.overview.addEventListener=function(t,i,r,n){var o=a.Diagram.prototype.addEventListener;"mousemove"===i?e.zone.runOutsideAngular((function(){return o.call(e,t,i,r,n)})):e.zone.run((function(){o.call(e,t,i,r,n)}))},this.overview.div=this.overviewDiv.nativeElement)},e.prototype.ngOnChanges=function(e){this.overview&&e&&e.observedDiagram&&e.observedDiagram.currentValue!==e.observedDiagram.previousValue&&(this.overview.observed=e.observedDiagram.currentValue)},e}();n.decorators=[{type:t.Component,args:[{selector:"gojs-overview",template:"<div #ngOverview [className]=divClassName></div>"}]}],n.ctorParameters=function(){return[{type:t.NgZone}]},n.propDecorators={initOverview:[{type:t.Input}],divClassName:[{type:t.Input}],observedDiagram:[{type:t.Input}],overviewDiv:[{type:t.ViewChild,args:["ngOverview",{static:!0}]}]};var o=function(){};o.decorators=[{type:t.NgModule,args:[{declarations:[i,n,r],imports:[],exports:[i,n,r]}]}];var s=function(){function e(){}return e.syncNodeData=function(e,t){if(!e)return t;if(!e.modifiedNodeData&&!e.insertedNodeKeys&&!e.removedNodeKeys)return t;var i=new a.Map;return e.modifiedNodeData&&e.modifiedNodeData.forEach((function(e){i.set(e.key,e);for(var a=e.key,r=0;r<t.length;r++){t[r].key===a&&(t[r]=e)}})),e.insertedNodeKeys&&e.insertedNodeKeys.forEach((function(e){var a=i.get(e);a&&t.push(a)})),e.removedNodeKeys&&(t=t.filter((function(t){return!e.removedNodeKeys.includes(t.key)}))),t},e.syncLinkData=function(e,t){if(!e)return t;if(!e.modifiedLinkData&&!e.insertedLinkKeys&&!e.removedLinkKeys)return t;var i=new a.Map;return e.modifiedLinkData&&e.modifiedLinkData.forEach((function(e){i.set(e.key,e);for(var a=e.key,r=0;r<t.length;r++){t[r].key===a&&(t[r]=e)}})),e.insertedLinkKeys&&e.insertedLinkKeys.forEach((function(e){var a=i.get(e);a&&t.push(a)})),e.removedLinkKeys&&(t=t.filter((function(t){return!e.removedLinkKeys.includes(t.key)}))),t},e.syncModelData=function(e,t){return e&&e.modelData?e.modelData?e.modelData:void 0:t},e}();s.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[]},s.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new s},token:s,providedIn:"root"}),e.DataSyncService=s,e.DiagramComponent=i,e.GojsAngularModule=o,e.OverviewComponent=n,e.PaletteComponent=r,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gojs-angular.umd.min.js.map